import{j as e,r as N,c as I,R as A}from"./client-DD4c7S6m.js";const V=({coupons:a,applyCoupon:d,selectedCoupon:s})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:t=>d(a[parseInt(t.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),a.map((t,o)=>e.jsxs("option",{value:o,children:[t.name," -"," ",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`]},t.code))]}),s&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인)"]})]}),j=({onClick:a,className:d,disabled:s=!1,text:t,...o})=>e.jsx("button",{onClick:a,className:d,disabled:s,...o,children:t}),$=({cart:a,removeFromCart:d,updateQuantity:s})=>{const t=n=>{const{discounts:i}=n.product,{quantity:r}=n;let m=0;for(const g of i)r>=g.quantity&&(m=Math.max(m,g.rate));return m},o="bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400";return e.jsx("div",{className:"space-y-2",children:a.map(n=>{const i=t(n);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:n.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n.product.price,"원 x ",n.quantity,i>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(i*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(j,{onClick:()=>s(n.product.id,n.quantity-1),className:o,text:"-"}),e.jsx(j,{onClick:()=>s(n.product.id,n.quantity+1),className:o,text:"+"}),e.jsx(j,{onClick:()=>d(n.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",text:"삭제"})]})]},n.product.id)})})},f=(a,d)=>{let s=0,t=0;a.forEach(n=>{const{price:i}=n.product,{quantity:r}=n;s+=i*r;const m=n.product.discounts.reduce((g,u)=>r>=u.quantity&&u.rate>g?u.rate:g,0);t+=i*r*(1-m)});let o=s-t;return d&&(d.discountType==="amount"?t=Math.max(0,t-d.discountValue):t*=1-d.discountValue/100,o=s-t),{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(t),totalDiscount:Math.round(o)}},F=(a,d,s)=>a.map(t=>{if(t.product.id===d){const o=t.product.stock,n=Math.max(0,Math.min(s,o));return n>0?{...t,quantity:n}:null}return t}).filter(t=>t!==null),M=({cart:a,selectedCoupon:d})=>{const{totalBeforeDiscount:s,totalAfterDiscount:t,totalDiscount:o}=f(a,d);return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",t.toLocaleString(),"원"]})]})]})},E=({coupons:a,cart:d,removeFromCart:s,updateQuantity:t,applyCoupon:o,selectedCoupon:n})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx($,{cart:d,removeFromCart:s,updateQuantity:t}),e.jsx(V,{coupons:a,applyCoupon:o,selectedCoupon:n}),e.jsx(M,{cart:d,selectedCoupon:n})]}),R=({product:a,remainingStock:d,addToCart:s})=>e.jsx(j,{onClick:()=>s(a),className:`w-full px-3 py-1 rounded ${d>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:d<=0,text:d>0?"장바구니에 추가":"품절"}),B=({product:a,remainingStock:d})=>{const s=t=>t.reduce((o,n)=>Math.max(o,n.rate),0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${d>0?"text-green-600":"text-red-600"}`,children:["재고: ",d,"개"]}),a.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(s(a.discounts)*100).toFixed(0),"% 할인"]})]}),a.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:a.discounts.map((t,o)=>e.jsxs("li",{children:[t.quantity,"개 이상: ",(t.rate*100).toFixed(0),"% 할인"]},o))})]})},L=({product:a})=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:a.name}),e.jsxs("span",{className:"text-gray-600",children:[a.price.toLocaleString(),"원"]})]}),Q=({products:a,cart:d,addToCart:s})=>{const t=o=>{const n=d.find(i=>i.product.id===o.id);return o.stock-((n==null?void 0:n.quantity)||0)};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:a.map(o=>{const n=t(o);return e.jsxs("div",{"data-testid":`product-${o.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsx(L,{product:o}),e.jsx(B,{product:o,remainingStock:n}),e.jsx(R,{product:o,remainingStock:n,addToCart:s})]},o.id)})})]})},O=()=>{const[a,d]=N.useState([]),[s,t]=N.useState(null),o=u=>{const x=a.find(p=>p.product.id===u.id);return u.stock-((x==null?void 0:x.quantity)||0)};return{cart:a,addToCart:u=>{o(u)<=0||d(p=>p.find(y=>y.product.id===u.id)?p.map(y=>y.product.id===u.id?{...y,quantity:Math.min(y.quantity+1,u.stock)}:y):[...p,{product:u,quantity:1}])},removeFromCart:u=>{d(x=>x.filter(p=>p.product.id!==u))},updateQuantity:(u,x)=>{d(p=>F(p,u,x))},applyCoupon:u=>{t(u)},calculateTotal:()=>f(a,s),selectedCoupon:s}},U=({products:a,coupons:d})=>{const{cart:s,addToCart:t,removeFromCart:o,updateQuantity:n,applyCoupon:i,selectedCoupon:r}=O();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Q,{products:a,cart:s,addToCart:t}),e.jsx(E,{coupons:d,cart:s,removeFromCart:o,updateQuantity:n,addToCart:t,applyCoupon:i,selectedCoupon:r})]})]})},W=({onProductAdd:a})=>{const[d,s]=N.useState(!1),[t,o]=N.useState({name:"",price:0,stock:0,discounts:[]}),n=()=>{const i={...t,id:Date.now().toString()};a(i),o({name:"",price:0,stock:0,discounts:[]}),s(!1)};return e.jsxs("div",{children:[e.jsx(j,{onClick:()=>s(!d),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",text:d?"취소":"새 상품 추가"}),d&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:i=>o({...t,name:i.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:i=>o({...t,price:parseInt(i.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:i=>o({...t,stock:parseInt(i.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx(j,{onClick:n,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",text:"추가"})]})]})},_=({products:a,coupons:d,onProductUpdate:s,onProductAdd:t,onCouponAdd:o})=>{const[n,i]=N.useState(new Set),[r,m]=N.useState(null),[g,u]=N.useState({quantity:0,rate:0}),[x,p]=N.useState({name:"",code:"",discountType:"percentage",discountValue:0}),v=c=>{i(h=>{const l=new Set(h);return l.has(c)?l.delete(c):l.add(c),l})},y=c=>{m({...c})},w=(c,h)=>{if(r&&r.id===c){const l={...r,name:h};m(l)}},C=(c,h)=>{if(r&&r.id===c){const l={...r,price:h};m(l)}},k=()=>{r&&(s(r),m(null))},P=(c,h)=>{const l=a.find(b=>b.id===c);if(l){const b={...l,stock:h};s(b),m(b)}},S=c=>{const h=a.find(l=>l.id===c);if(h&&r){const l={...h,discounts:[...h.discounts,g]};s(l),m(l),u({quantity:0,rate:0})}},q=(c,h)=>{const l=a.find(b=>b.id===c);if(l){const b={...l,discounts:l.discounts.filter((X,T)=>T!==h)};s(b),m(b)}},D=()=>{o(x),p({name:"",code:"",discountType:"percentage",discountValue:0})};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(W,{onProductAdd:t}),e.jsx("div",{className:"space-y-2",children:a.map((c,h)=>e.jsxs("div",{"data-testid":`product-${h+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsx(j,{"data-testid":"toggle-button",onClick:()=>v(c.id),className:"w-full text-left font-semibold",text:`${c.name} - ${c.price}원 (재고: ${c.stock})`}),n.has(c.id)&&e.jsx("div",{className:"mt-2",children:r&&r.id===c.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:r.name,onChange:l=>w(c.id,l.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:r.price,onChange:l=>C(c.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:r.stock,onChange:l=>P(c.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),r.discounts.map((l,b)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[l.quantity,"개 이상 구매 시"," ",l.rate*100,"% 할인"]}),e.jsx(j,{onClick:()=>q(c.id,b),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",text:"삭제"})]},b)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:g.quantity,onChange:l=>u({...g,quantity:parseInt(l.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:g.rate*100,onChange:l=>u({...g,rate:parseInt(l.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx(j,{onClick:()=>S(c.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",text:"할인 추가"})]})]}),e.jsx(j,{onClick:k,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",text:"수정 완료"})]}):e.jsxs("div",{children:[c.discounts.map((l,b)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[l.quantity,"개 이상 구매 시"," ",l.rate*100,"% 할인"]})},b)),e.jsx(j,{"data-testid":"modify-button",onClick:()=>y(c),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",text:"수정"})]})})]},c.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:x.name,onChange:c=>p({...x,name:c.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:x.code,onChange:c=>p({...x,code:c.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:x.discountType,onChange:c=>p({...x,discountType:c.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:x.discountValue,onChange:c=>p({...x,discountValue:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx(j,{onClick:D,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",text:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:d.map((c,h)=>e.jsxs("div",{"data-testid":`coupon-${h+1}`,className:"bg-gray-100 p-2 rounded",children:[c.name," (",c.code,"):",c.discountType==="amount"?`${c.discountValue}원`:`${c.discountValue}%`," ","할인"]},h))})]})]})]})]})]})},z=a=>{const[d,s]=N.useState(a);return{coupons:d,addCoupon:i=>{s(r=>[...r,i])},removeCoupon:i=>{s(r=>r.filter(m=>m.code!==i))},applyCoupon:i=>{const r=d.find(m=>m.code===i);console.log(r)}}},G=a=>{const[d,s]=N.useState(a);return{products:d,updateProduct:n=>{s(i=>i.map(r=>r.id===n.id?n:r))},addProduct:n=>{s(i=>[...i,n])}}},H=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],J=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],K=()=>{const{products:a,updateProduct:d,addProduct:s}=G(H),{coupons:t,addCoupon:o}=z(J),[n,i]=N.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx(j,{onClick:()=>i(!n),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",text:n?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:n?e.jsx(_,{products:a,coupons:t,onProductUpdate:d,onProductAdd:s,onCouponAdd:o}):e.jsx(U,{products:a,coupons:t})})]})};I.createRoot(document.getElementById("root")).render(e.jsx(A.StrictMode,{children:e.jsx(K,{})}));
